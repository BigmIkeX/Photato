<html>
    <head>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="//ajax.aspnetcdn.com/ajax/knockout/knockout-3.3.0.js"></script>
        <script src="/js/hammer.js"></script>
        <script src="/js/app.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href='https://fonts.googleapis.com/css?family=Suranna|Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <title>Phototo</title>
    </head>

    <body>  
        <div id="topbar">
            <div class="pageContainer row">
                <h1 class="left" data-bind="click: function(){moveToFolder('', true)}">Phototo</h1>

                <form class="right" data-bind="submit: runSearchFromForm">
                    <div id="searchForm">
                        <input id="searchField" type="text" autocomplete="off" placeholder="Search"  />
                        <button type="submit">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="mainContent">
            <div class="pageContainer">
                <h2 data-bind="text: currentPageTitle"></h2>

                <ul id="breadcrumb" data-bind="foreach: breadcrumbs">
                    <li>
                        <a data-bind="text: title, click: function(){if(url!=='#'){ $parent.moveToFolder(url, true)}}"></a>
                    </li>
                </ul>

                <div id="folders-gallery" data-bind="foreach: folders, style: {'margin':folders().length?'':'20px'}">
                    <div class="folder" data-bind="click: () => $parent.moveToFolder(path, true), style: {'background-image':'url(\''+thumbnail.url+'\')', width: thumbnail.height+'px', height: thumbnail.height+'px'}">
                        <div class="legend">
                            <i class="fa fa-folder"></i>
                            <span data-bind="text: filename"></span>
                        </div>
                    </div>
                </div>

                <div id="pictures-gallery" data-bind="foreach: pictures">
                    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-bind=" style: {'background-image':'url(\''+thumbnail.url+'\')'} , attr: { 'data-width': thumbnail.width, width: thumbnail.width, height: thumbnail.height }, click: () => $parent.openFullScreenDisplay($index())" />
                </div>
            </div>
        </div>

        <div id="fullscreenPicture" data-bind="visible: fullscreenPicture(), click: closeFullScreenDisplay">
            <ko data-bind="if: fullscreenPicture()">  
                <img class="fullscreenPictureThumbnail" data-bind="attr: { src: fullscreenPicture().thumbnail.url }, click: ()=>null, clickBubble: false" />
                <img class="fullscreenPictureImg" data-bind="click: ()=>null, clickBubble: false" onload="switchPictureIn()" />
                <div class="pictureLegend">
                    <div class="pictureTitle row">
                        <div class="left-medium-up left-align" data-bind="text: (fullscreenPicture().title || fullscreenPicture().parentAndName)"></div>
                        <div class="right-medium-up right-align-medium-up" data-bind="text: function(){ return new Date(fullscreenPicture().pictureCreationDate).toLocaleDateString()}()"></div>
                    </div>

                    <div class="pictureSubtitle row">
                        <div class="left-medium-up left-align">
                            <span data-bind="text: fullscreenPicture().position.hardcodedPosition || (fullscreenPicture().position.coordinatesDescription && fullscreenPicture().position.coordinatesDescription.length && fullscreenPicture().position.coordinatesDescription) || ''"></span>
                        </div>
                        <div class="right-medium-up right-align-medium-up">
                            <div data-bind="text:  fullscreenPicture().persons && fullscreenPicture().persons.sort().join(', ')"></div>
                            <div class="pictureSubSubtitle" data-bind="text:  fullscreenPicture().tags && fullscreenPicture().tags.sort().join(', ')"></div>
                        </div>
                    </div>
                </div>
                <div class="arrow left-arrow" data-bind="click: moveToPreviousPicture, clickBubble: false">
                    <i class="fa fa-angle-left"></i>
                </div>
                <div class="arrow right-arrow" data-bind="click: moveToNextPicture, clickBubble: false">
                    <i class="fa fa-angle-right"></i>
                </div>
            </ko>
        </div>

        <script type="text/javascript">
            var appVM = new GalleryViewModel();
            ko.applyBindings(appVM);
        </script>
    </body>
</html>